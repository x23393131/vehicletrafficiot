{"filter":false,"title":"dashboard.js","tooltip":"/static/js/dashboard.js","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":38,"column":2},"action":"insert","lines":["// Initialize the map","const map = L.map('map').setView([53.349805, -6.26031], 13);","L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {","    attribution: '&copy; OpenStreetMap contributors'","}).addTo(map);","","// Function to update the dashboard with new data","function updateDashboard(data) {","    // Update vehicle count","    document.getElementById('vehicle-count').textContent = ","        `${data.vehicle_count} vehicles`;","    ","    // Update traffic status","    const trafficElement = document.getElementById('current-traffic');","    let badgeClass = 'badge bg-success';","    if (data.traffic_level === 'MEDIUM') badgeClass = 'badge bg-warning';","    if (data.traffic_level === 'HEAVY') badgeClass = 'badge bg-danger';","    ","    trafficElement.innerHTML = ","        `<span class=\"${badgeClass}\">${data.traffic_level} TRAFFIC</span>`;","    ","    // Update map with new marker","    L.marker([data.lat, data.lng]).addTo(map)","        .bindPopup(`Vehicles: ${data.vehicle_count}`)","        .openPopup();","}","","// WebSocket connection for real-time updates","const socket = new WebSocket(`ws://${window.location.host}/ws`);","","socket.onmessage = function(event) {","    const data = JSON.parse(event.data);","    updateDashboard(data);","};","","socket.onclose = function() {","    document.getElementById('connection-status').className = 'badge bg-danger';","    document.getElementById('connection-status').textContent = 'Disconnected';","};"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":38,"column":2},"action":"remove","lines":["// Initialize the map","const map = L.map('map').setView([53.349805, -6.26031], 13);","L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {","    attribution: '&copy; OpenStreetMap contributors'","}).addTo(map);","","// Function to update the dashboard with new data","function updateDashboard(data) {","    // Update vehicle count","    document.getElementById('vehicle-count').textContent = ","        `${data.vehicle_count} vehicles`;","    ","    // Update traffic status","    const trafficElement = document.getElementById('current-traffic');","    let badgeClass = 'badge bg-success';","    if (data.traffic_level === 'MEDIUM') badgeClass = 'badge bg-warning';","    if (data.traffic_level === 'HEAVY') badgeClass = 'badge bg-danger';","    ","    trafficElement.innerHTML = ","        `<span class=\"${badgeClass}\">${data.traffic_level} TRAFFIC</span>`;","    ","    // Update map with new marker","    L.marker([data.lat, data.lng]).addTo(map)","        .bindPopup(`Vehicles: ${data.vehicle_count}`)","        .openPopup();","}","","// WebSocket connection for real-time updates","const socket = new WebSocket(`ws://${window.location.host}/ws`);","","socket.onmessage = function(event) {","    const data = JSON.parse(event.data);","    updateDashboard(data);","};","","socket.onclose = function() {","    document.getElementById('connection-status').className = 'badge bg-danger';","    document.getElementById('connection-status').textContent = 'Disconnected';","};"],"id":2},{"start":{"row":0,"column":0},"end":{"row":66,"column":1},"action":"insert","lines":["// Initialize the map","const map = L.map('map').setView([53.349805, -6.26031], 13);","L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {","    attribution: '&copy; OpenStreetMap contributors'","}).addTo(map);","","// Store markers to update them instead of creating new ones","const markers = {};","","// Connect to Socket.IO","const socket = io({","    reconnection: true,","    reconnectionAttempts: 5,","    reconnectionDelay: 1000","});","","// Connection status handlers","socket.on('connect', () => {","    document.getElementById('connection-status').className = 'badge bg-success';","    document.getElementById('connection-status').textContent = 'Connected';","    console.log('Connected to server');","});","","socket.on('disconnect', () => {","    document.getElementById('connection-status').className = 'badge bg-danger';","    document.getElementById('connection-status').textContent = 'Disconnected';","    console.log('Disconnected from server');","});","","// Handle incoming data","socket.on('update', (data) => {","    updateDashboard(data);","});","","// Function to update the dashboard with new data","function updateDashboard(data) {","    // Update vehicle count","    document.getElementById('vehicle-count').textContent = ","        `${data.vehicle_count} vehicles`;","    ","    // Update traffic status","    const trafficElement = document.getElementById('current-traffic');","    let badgeClass = 'badge bg-success';","    if (data.traffic_level === 'MEDIUM') badgeClass = 'badge bg-warning';","    if (data.traffic_level === 'HEAVY') badgeClass = 'badge bg-danger';","    ","    trafficElement.innerHTML = ","        `<span class=\"${badgeClass}\">${data.traffic_level} TRAFFIC</span>`;","    ","    // Update map marker","    const markerKey = `${data.lat}-${data.lng}`;","    if (!markers[markerKey]) {","        markers[markerKey] = L.marker([data.lat, data.lng]).addTo(map);","    }","    markers[markerKey]","        .setLatLng([data.lat, data.lng])","        .bindPopup(`","            <b>Location:</b> ${data.lat.toFixed(4)}, ${data.lng.toFixed(4)}<br>","            <b>Vehicles:</b> ${data.vehicle_count}<br>","            <b>Status:</b> ${data.traffic_level}<br>","            <b>Gateway:</b> ${data.gateway || 'Unknown'}","        `)","        .openPopup();","    ","    // Center map on new data","    map.setView([data.lat, data.lng], 13);","}"]}],[{"start":{"row":0,"column":0},"end":{"row":35,"column":1},"action":"insert","lines":["// Replace your existing socket code with:","const socket = io({","    reconnection: true,","    reconnectionDelay: 1000,","    reconnectionAttempts: 5","});","","socket.on('connect', () => {","    console.log('Connected to server');","    document.getElementById('connection-status').className = 'badge bg-success';","    document.getElementById('connection-status').textContent = 'Connected';","});","","socket.on('update', (data) => {","    console.log('Received update:', data);  // Debug log","    updateDashboard(data);","});","","function updateDashboard(data) {","    console.log('Updating with:', data);  // Debug log","    ","    // Update vehicle count","    document.getElementById('vehicle-count').textContent = ","        `${data.vehicle_count} vehicles`;","    ","    // Update traffic status","    const trafficElement = document.getElementById('current-traffic');","    let badgeClass = 'badge bg-success';","    if (data.traffic_level === 'MEDIUM') badgeClass = 'badge bg-warning';","    if (data.traffic_level === 'HEAVY') badgeClass = 'badge bg-danger';","    ","    trafficElement.innerHTML = ","        `<span class=\"${badgeClass}\">${data.traffic_level} TRAFFIC</span>`;","    ","    // Update map (add your existing map code here)","}"],"id":4}],[{"start":{"row":0,"column":0},"end":{"row":66,"column":1},"action":"remove","lines":["// Initialize the map","const map = L.map('map').setView([53.349805, -6.26031], 13);","L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {","    attribution: '&copy; OpenStreetMap contributors'","}).addTo(map);","","// Store markers to update them instead of creating new ones","const markers = {};","","// Connect to Socket.IO","const socket = io({","    reconnection: true,","    reconnectionAttempts: 5,","    reconnectionDelay: 1000","});","","// Connection status handlers","socket.on('connect', () => {","    document.getElementById('connection-status').className = 'badge bg-success';","    document.getElementById('connection-status').textContent = 'Connected';","    console.log('Connected to server');","});","","socket.on('disconnect', () => {","    document.getElementById('connection-status').className = 'badge bg-danger';","    document.getElementById('connection-status').textContent = 'Disconnected';","    console.log('Disconnected from server');","});","","// Handle incoming data","socket.on('update', (data) => {","    updateDashboard(data);","});","","// Function to update the dashboard with new data","function updateDashboard(data) {","    // Update vehicle count","    document.getElementById('vehicle-count').textContent = ","        `${data.vehicle_count} vehicles`;","    ","    // Update traffic status","    const trafficElement = document.getElementById('current-traffic');","    let badgeClass = 'badge bg-success';","    if (data.traffic_level === 'MEDIUM') badgeClass = 'badge bg-warning';","    if (data.traffic_level === 'HEAVY') badgeClass = 'badge bg-danger';","    ","    trafficElement.innerHTML = ","        `<span class=\"${badgeClass}\">${data.traffic_level} TRAFFIC</span>`;","    ","    // Update map marker","    const markerKey = `${data.lat}-${data.lng}`;","    if (!markers[markerKey]) {","        markers[markerKey] = L.marker([data.lat, data.lng]).addTo(map);","    }","    markers[markerKey]","        .setLatLng([data.lat, data.lng])","        .bindPopup(`","            <b>Location:</b> ${data.lat.toFixed(4)}, ${data.lng.toFixed(4)}<br>","            <b>Vehicles:</b> ${data.vehicle_count}<br>","            <b>Status:</b> ${data.traffic_level}<br>","            <b>Gateway:</b> ${data.gateway || 'Unknown'}","        `)","        .openPopup();","    ","    // Center map on new data","    map.setView([data.lat, data.lng], 13);","}"],"id":3}]]},"ace":{"folds":[],"scrolltop":828,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":66,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":89,"mode":"ace/mode/javascript"}},"timestamp":1754642330641,"hash":"ac51fab6f630f3f154eb1d1391f2d4dc98e91850"}